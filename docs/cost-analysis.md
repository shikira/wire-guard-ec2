# コスト分析詳細

このドキュメントでは、WireGuard VPN on EC2ソリューションの詳細なコスト分析と、AWS Client VPNとの比較を提供します。

## 目次

- [コスト概要](#コスト概要)
- [詳細コスト内訳](#詳細コスト内訳)
- [AWS Client VPNとの比較](#aws-client-vpnとの比較)
- [コスト最適化戦略](#コスト最適化戦略)
- [シナリオ別コスト試算](#シナリオ別コスト試算)
- [隠れたコスト](#隠れたコスト)

## コスト概要

### 基本シナリオ

- **利用期間**: 10日間 (240時間)
- **リージョン**: 東京 (ap-northeast-1)
- **インスタンス**: t3.micro
- **データ転送量**: 300GB/月
- **接続デバイス数**: 10台 (同時接続2-3台)

### 合計コスト

| 期間 | 合計コスト | 月額換算 |
|------|-----------|---------|
| **10日間** | **$38.73** (約5,800円) | - |
| **30日間** | **$116.37** | **$116.37** (約17,500円) |
| **1年間** | - | **$1,396.44** (約210,000円) |

## 詳細コスト内訳

### 1. EC2インスタンス費用

#### t3.micro 価格 (東京リージョン)

```
時間単価: $0.0128/時間
```

#### 計算

| 期間 | 計算式 | コスト |
|------|--------|--------|
| 10日間 | $0.0128 × 240時間 | $3.07 |
| 30日間 | $0.0128 × 720時間 | $9.22 |
| 1年間 | $0.0128 × 8,760時間 | $112.13 |

**節約のヒント**:
- 1年リザーブドインスタンス: 約40%割引 → **$67.28/年**
- 3年リザーブドインスタンス: 約60%割引 → **$44.85/年**

### 2. EBSストレージ費用

#### gp3ボリューム価格 (東京リージョン)

```
容量単価: $0.096/GB/月
IOPS単価: $0.005/IOPS/月 (3,000 IOPS以上)
スループット単価: $0.04/MB/s/月 (125 MB/s以上)
```

#### 計算 (8GB, デフォルトIOPS/スループット)

| 期間 | 計算式 | コスト |
|------|--------|--------|
| 10日間 | $0.096 × 8GB × (10/30) | $0.26 |
| 30日間 | $0.096 × 8GB | $0.77 |
| 1年間 | $0.096 × 8GB × 12 | $9.22 |

**節約のヒント**:
- 最小構成(8GB)で十分
- スナップショット不要(設定は再生成可能)

### 3. データ転送費用

#### アウトバウンド料金 (東京リージョン)

| データ量 | 料金 |
|---------|------|
| 最初の10TB/月 | $0.114/GB |
| 次の40TB/月 | $0.089/GB |
| 次の100TB/月 | $0.086/GB |
| 150TB超/月 | $0.084/GB |

**インバウンドは無料**

#### 計算 (300GB/月想定)

| 期間 | データ量 | 計算式 | コスト |
|------|---------|--------|--------|
| 10日間 | 100GB | 100GB × $0.114 | $11.40 |
| 30日間 | 300GB | 300GB × $0.114 | $34.20 |
| 1年間 | 3.6TB | 3,600GB × $0.114 | $410.40 |

**データ転送量の見積もり根拠**:
- HD動画視聴: 約3GB/時間
- 1日3時間視聴 × 10日間 = 90GB
- その他のWebブラウジング等: 10GB
- **合計: 約100GB (10日間)**

### 4. Elastic IP費用

#### 料金体系

```
稼働中のインスタンスに紐付けられている場合: 無料
停止中のインスタンスに紐付けられている場合: $0.005/時間
未使用のElastic IP: $0.005/時間
```

#### 計算

| シナリオ | 期間 | コスト |
|---------|------|--------|
| 稼働中 (推奨) | 10日間 | $0.00 |
| スタック削除後 | - | $0.00 |
| 停止中 (非推奨) | 10日間 | $1.20 |

**重要**: 使用後は必ずスタック削除を実行し、Elastic IPを解放してください。

### 5. CloudWatch費用

#### 無料枠

- 基本メトリクス (5分間隔): 無料
- 詳細モニタリング (1分間隔): 有料
- API リクエスト: 月100万件まで無料
- ログ: 月5GBまで無料
- ダッシュボード: 月3個まで無料

#### 有料部分 (オプション)

| 項目 | 料金 | 本プロジェクト |
|------|------|--------------|
| カスタムメトリクス | $0.30/メトリクス/月 | $0.30 |
| アラーム | $0.10/アラーム/月 | $0.20 (2個) |
| ログ取り込み | $0.50/GB | 無料枠内 |
| ログ保存 | $0.0316/GB/月 | 無料枠内 |

#### 計算 (最小構成)

| 期間 | コスト |
|------|--------|
| 10日間 | $0.17 |
| 30日間 | $0.50 |
| 1年間 | $6.00 |

**節約のヒント**:
- 基本メトリクスのみ使用 (無料)
- ログ保持期間を7日に設定
- カスタムメトリクスは必要最小限

### 6. Systems Manager費用

#### Session Manager

```
料金: 無料
```

Session Managerの使用に追加料金はかかりません。

#### Parameter Store

```
標準パラメータ: 無料 (月10,000件まで)
高度なパラメータ: $0.05/パラメータ/月
```

本プロジェクトでは標準パラメータのみ使用するため、**無料**です。

## AWS Client VPNとの比較

### 価格比較表 (10日間)

| コスト項目 | WireGuard EC2 | AWS Client VPN | 差額 |
|-----------|---------------|----------------|------|
| インフラ基本料金 | $3.07 | $36.00 | **-$32.93** |
| 接続料金 | $0.00 | $30.00 | **-$30.00** |
| ストレージ | $0.26 | $0.00 | +$0.26 |
| データ転送 | $34.20 | $34.20 | $0.00 |
| Elastic IP | $1.20 | $1.20 | $0.00 |
| 監視 | $0.00 | $0.00 | $0.00 |
| **合計** | **$38.73** | **$101.40** | **-$62.67** |

### 節約率

```
節約額: $62.67 (10日間)
節約率: 62%
```

### 価格比較表 (30日間)

| コスト項目 | WireGuard EC2 | AWS Client VPN | 差額 |
|-----------|---------------|----------------|------|
| インフラ基本料金 | $9.22 | $108.00 | **-$98.78** |
| 接続料金 | $0.00 | $90.00 | **-$90.00** |
| ストレージ | $0.77 | $0.00 | +$0.77 |
| データ転送 | $102.60 | $102.60 | $0.00 |
| Elastic IP | $3.60 | $3.60 | $0.00 |
| 監視 | $0.50 | $0.00 | +$0.50 |
| **合計** | **$116.69** | **$304.20** | **-$187.51** |

### 年間コスト比較

| ソリューション | 年間コスト | 節約額 |
|--------------|----------|--------|
| WireGuard EC2 | **$1,396.44** | - |
| AWS Client VPN | **$3,650.40** | **-$2,253.96** |

**節約率: 62%**

### AWS Client VPN 価格内訳

#### エンドポイント関連付け料金

```
東京リージョン: $0.15/時間/サブネット関連付け
```

この料金は**常時発生**し、誰も接続していなくても課金されます。

| 期間 | 計算式 | コスト |
|------|--------|--------|
| 10日間 | $0.15 × 240時間 | $36.00 |
| 30日間 | $0.15 × 720時間 | $108.00 |
| 1年間 | $0.15 × 8,760時間 | $1,314.00 |

#### 接続料金

```
東京リージョン: $0.05/時間/接続
```

実際の接続時間のみ課金されます。

| シナリオ | 同時接続数 | 時間 | 計算式 | コスト(10日) |
|---------|----------|------|--------|------------|
| 軽度利用 | 1台 | 240h | $0.05 × 1 × 240 | $12.00 |
| 中度利用 | 2.5台 | 240h | $0.05 × 2.5 × 240 | $30.00 |
| 重度利用 | 5台 | 240h | $0.05 × 5 × 240 | $60.00 |

## コスト最適化戦略

### 1. インスタンスの最適化

#### インスタンスタイプの選択

| 接続数 | 推奨タイプ | 月額コスト | 備考 |
|--------|----------|----------|------|
| ~10台 | **t3.micro** | $9.22 | 推奨 |
| ~25台 | t3.small | $18.44 | 2倍の料金 |
| ~50台 | t3.medium | $36.88 | 4倍の料金 |

#### リザーブドインスタンス

長期利用の場合、リザーブドインスタンスで大幅節約:

| 期間 | 割引率 | 年間コスト | 節約額 |
|------|--------|----------|--------|
| オンデマンド | 0% | $112.13 | - |
| 1年 (前払いなし) | ~30% | $78.49 | $33.64 |
| 1年 (全額前払い) | ~40% | $67.28 | $44.85 |
| 3年 (全額前払い) | ~60% | $44.85 | $67.28 |

### 2. データ転送の最適化

#### データ使用量削減テクニック

| 方法 | 削減率 | 節約額(月) |
|------|--------|-----------|
| 動画品質を720p → 480p | ~50% | $17.10 |
| 広告ブロッカー使用 | ~20% | $6.84 |
| スプリットトンネル (特定サイトのみVPN) | ~70% | $23.94 |

#### スプリットトンネル設定

日本のサービスのみVPN経由にすることで、データ転送量を大幅削減:

```ini
# クライアント設定 (client.conf)
[Interface]
Address = 10.8.0.2/32
PrivateKey = <client-private-key>

[Peer]
PublicKey = <server-public-key>
PresharedKey = <preshared-key>
Endpoint = <server-elastic-ip>:51820

# 日本のサービスのみVPN経由
AllowedIPs = 203.0.113.0/24  # 例: 特定のサービスIP範囲
# AllowedIPs = 0.0.0.0/0 の代わりに特定IPのみ指定
```

### 3. 稼働時間の最適化

#### 自動停止/起動スケジュール (オプション)

深夜など使わない時間帯は停止:

| 運用パターン | 稼働時間/日 | 月額EC2コスト | 節約額 |
|-------------|-----------|-------------|--------|
| 24時間稼働 | 24h | $9.22 | - |
| 12時間稼働 | 12h | $4.61 | $4.61 |
| 8時間稼働 | 8h | $3.07 | $6.15 |

**注意**: Elastic IP は停止中も課金されるため、完全に使わない場合はスタック削除が推奨。

### 4. ストレージの最適化

#### EBS サイズ調整

| サイズ | 月額コスト | 用途 |
|--------|----------|------|
| 8GB | $0.77 | 推奨 (最小構成) |
| 16GB | $1.54 | 不要 |
| 20GB | $1.92 | 不要 |

**推奨**: 8GBで十分です。ログはCloudWatchに送信。

### 5. 監視コストの最適化

#### 無料枠の活用

| 項目 | 無料枠 | 推奨設定 |
|------|--------|---------|
| メトリクス | 基本メトリクス無料 | 基本メトリクスのみ |
| ログ | 5GB/月 | 7日保持 |
| アラーム | - | 必要最小限(2個) |
| ダッシュボード | 3個/月 | 1個 |

## シナリオ別コスト試算

### シナリオ1: 短期出張 (10日間)

**想定**: 海外出張中のみ利用、その後削除

| 項目 | コスト |
|------|--------|
| EC2 (t3.micro) | $3.07 |
| EBS (8GB) | $0.26 |
| データ転送 (100GB) | $11.40 |
| Elastic IP | $0.00 |
| 監視 | $0.00 |
| **合計** | **$14.73** |

### シナリオ2: 長期出張 (30日間)

**想定**: 1ヶ月の海外滞在、動画視聴多め

| 項目 | コスト |
|------|--------|
| EC2 (t3.micro) | $9.22 |
| EBS (8GB) | $0.77 |
| データ転送 (300GB) | $34.20 |
| Elastic IP | $0.00 |
| 監視 | $0.50 |
| **合計** | **$44.69** |

### シナリオ3: 常時利用 (1年間)

**想定**: 恒常的なVPN利用、リザーブドインスタンス利用

| 項目 | コスト |
|------|--------|
| EC2 (RI 1年全額前払い) | $67.28 |
| EBS (8GB) | $9.22 |
| データ転送 (3.6TB) | $410.40 |
| Elastic IP | $0.00 |
| 監視 | $6.00 |
| **合計** | **$492.90** |

**AWS Client VPN比較**: $3,650.40 → **$3,157.50の節約 (87%削減)**

### シナリオ4: 複数ユーザー (小規模チーム)

**想定**: 5人で共用、常時利用

| 項目 | コスト |
|------|--------|
| EC2 (t3.small, RI 1年) | $134.56 |
| EBS (8GB) | $9.22 |
| データ転送 (1.5TB, 5人分) | $171.00 |
| Elastic IP | $0.00 |
| 監視 | $6.00 |
| **合計/年** | **$320.78** |
| **1人あたり/年** | **$64.16** |

**AWS Client VPN比較 (5人)**: $3,650.40 + 追加接続料 → **約$5,000以上の節約**

## 隠れたコスト

### WireGuard EC2の隠れたコスト

1. **学習時間**: 初回セットアップに2-4時間
2. **運用工数**: クライアント追加・削除の手動作業
3. **セキュリティアップデート**: 月1回程度のパッチ適用
4. **トラブルシューティング**: 問題発生時の調査時間

**時給換算すると**: 初回10時間 + 月2時間の運用
- 時給$50と仮定: 初回$500 + 月$100
- ただし、CDKによる自動化で大幅に削減可能

### AWS Client VPNの隠れたコスト

1. **NAT Gateway料金** (フルトンネルモードの場合)
   - $0.062/時間 = 月$44.64
   - データ処理料金: $0.062/GB = 300GBで$18.60
   - **合計: 月$63.24の追加コスト**

2. **エンドポイント削除忘れ**
   - 使用後に削除しないと永続課金
   - 月$108の無駄なコスト発生リスク

### コスト比較まとめ (真のコスト)

| 項目 | WireGuard EC2 | AWS Client VPN |
|------|---------------|----------------|
| 基本料金 (月) | $44.69 | $304.20 |
| NAT Gateway | $0.00 | $63.24 |
| 運用工数 (時給$50) | $100.00 | $0.00 |
| **実質合計 (月)** | **$144.69** | **$367.44** |

それでも**60%の節約**

## コスト監視とアラート

### CloudWatch請求アラートの設定

#### 推奨アラート設定

| アラーム | 閾値 | アクション |
|---------|------|-----------|
| 月間コスト | > $50 | SNS通知 |
| 日次データ転送 | > 20GB/day | SNS通知 |
| 予想月額 | > $100 | SNS通知 + 調査 |

### AWS Cost Explorer の活用

月次でコストレビューを実施:

1. サービス別コスト確認
2. データ転送量のトレンド分析
3. 不要リソースの検出
4. 予算との差異確認

## まとめ

### コスト削減のポイント

1. **WireGuard EC2は AWS Client VPNより62%安い**
2. **データ転送が最大のコスト要因** (90%)
3. **スタック削除でゼロコストに**
4. **リザーブドインスタンスで長期利用はさらに安く**
5. **スプリットトンネルで70%のデータ転送削減可能**

### 推奨コスト最適化プラン

**短期利用 (10日間)**:
- オンデマンドt3.micro
- スプリットトンネル設定
- 使用後は必ずスタック削除
- **目標コスト: $15以下**

**長期利用 (1年以上)**:
- 1年リザーブドインスタンス (全額前払い)
- 基本メトリクスのみ
- ログ保持7日
- **目標コスト: $500以下/年**

## 参考資料

- [AWS料金計算ツール](https://calculator.aws/#/)
- [AWS Client VPN 料金](https://aws.amazon.com/vpn/pricing/)
- [Amazon EC2 料金](https://aws.amazon.com/ec2/pricing/)
- [AWS データ転送料金](https://aws.amazon.com/ec2/pricing/on-demand/#Data_Transfer)

---

**更新日**: 2025-11-17
**バージョン**: 1.0
**為替レート**: $1 = ¥150 (概算)
